function calculate(){
 const modeVal=parseFloat(document.getElementById("mode").value);
 if(isTrapMode){
   let limit=(modeVal>1)?16:8;
   let used=0;
   const list=document.getElementById("trapList");
   list.innerHTML="";
   document.querySelectorAll(".enemy-count").forEach(input=>{
     let count=parseInt(input.value)||0;
     let name=input.parentElement.querySelector(".enemy-name-text").textContent;
     
     let finalCount = 0;
     
     if (count > 0) {
       // If player entered a number, just double it
       finalCount = count * 2;
     } else if (name === "???" && used < limit) {
       // Special case: if Random is 0, Trap Card adds 2
       let added = Math.min(2, limit - used);
       finalCount = added;
       used += added;
     }
     
     if(finalCount > 0){
        const li=document.createElement("li");
        li.innerHTML=`${name} <span>${finalCount}</span>`;
        list.appendChild(li);
     }
   });
 } else {
   // Upgrade logic...
   let players=parseInt(document.getElementById("players").value)||1;
   let total=0;
   const sqrtP=Math.sqrt(players);
   document.querySelectorAll(".option:checked").forEach(opt=>{
     let basePrice = Number(opt.dataset.price);
     let price=Math.ceil(basePrice*sqrtP);
     total+=Math.ceil(price*modeVal);
   });
   document.getElementById("result").textContent="Total: "+total.toLocaleString();
 }
}
